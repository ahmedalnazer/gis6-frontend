import React, { PureComponent } from 'react';
import ReactEcharts from "echarts-for-react";
import * as PropTypes from 'prop-types'

//automatic update
//https://echarts.apache.org/en/tutorial.html#Loading%20and%20Updating%20of%20Asynchronous%20Data
//https://echarts.apache.org/examples/zh/editor.html?c=doc-example/tutorial-dynamic-data

var data = [
	[[0.0, 35.692], [0.02, 35.003999999999998], [0.040000000000000001, 35.003999999999998], [0.059999999999999998, 35.003999999999998], [0.080000000000000002, 35.003999999999998], [0.10000000000000001, 35.003999999999998], [0.12, 35.003999999999998], [0.14000000000000001, 35.555], [0.16, 35.003999999999998], [0.17999999999999999, 35.624000000000002], [0.20000000000000001, 35.451999999999998], [0.22, 35.244999999999997], [0.23999999999999999, 35.555], [0.26000000000000001, 35.039000000000001], [0.28000000000000003, 34.798000000000002], [0.29999999999999999, 35.314], [0.32000000000000001, 35.314], [0.34000000000000002, 35.521000000000001], [0.35999999999999999, 35.486000000000004], [0.38, 35.451999999999998], [0.40000000000000002, 35.039000000000001], [0.41999999999999998, 34.936], [0.44, 35.108000000000004], [0.46000000000000002, 35.177], [0.47999999999999998, 35.244999999999997], [0.5, 35.280000000000001], [0.52000000000000002, 34.866999999999997], [0.54000000000000004, 34.832000000000001], [0.56000000000000005, 34.798000000000002], [0.57999999999999996, 35.314], [0.59999999999999998, 34.762999999999998], [0.62, 35.210999999999999], [0.64000000000000001, 34.901000000000003], [0.66000000000000003, 35.177], [0.68000000000000005, 34.728999999999999], [0.69999999999999996, 35.108000000000004], [0.71999999999999997, 34.762999999999998], [0.73999999999999999, 35.177], [0.76000000000000001, 35.039000000000001], [0.78000000000000003, 35.073], [0.80000000000000004, 34.832000000000001], [0.81999999999999995, 35.210999999999999], [0.83999999999999997, 34.625999999999998], [0.85999999999999999, 34.521999999999998], [0.88, 35.108000000000004], [0.90000000000000002, 35.177], [0.92000000000000004, 34.762999999999998], [0.93999999999999995, 35.003999999999998], [0.95999999999999996, 34.866999999999997], [0.97999999999999998, 34.591000000000001], [1.0, 34.695], [1.02, 35.244999999999997], [1.04, 35.244999999999997], [1.0600000000000001, 34.832000000000001], [1.0800000000000001, 35.003999999999998], [1.1000000000000001, 34.798000000000002], [1.1200000000000001, 34.901000000000003], [1.1399999999999999, 34.866999999999997], [1.1599999999999999, 35.210999999999999], [1.1799999999999999, 34.936], [1.2, 34.936], [1.22, 34.660000000000004], [1.24, 35.142000000000003], [1.26, 34.591000000000001], [1.28, 35.039000000000001], [1.3, 34.969999999999999], [1.3200000000000001, 34.798000000000002], [1.3400000000000001, 35.210999999999999], [1.3600000000000001, 34.762999999999998], [1.3799999999999999, 35.314], [1.3999999999999999, 35.073], [1.4199999999999999, 35.244999999999997], [1.4399999999999999, 37.302999999999997], [1.46, 50.158999999999999], [1.48, 65.769999999999996], [1.5, 73.712000000000003], [1.52, 74.257000000000005], [1.54, 73.840000000000003], [1.5600000000000001, 72.558000000000007], [1.5800000000000001, 72.141000000000005], [1.6000000000000001, 70.924000000000007], [1.6200000000000001, 70.763000000000005], [1.6399999999999999, 70.186000000000007], [1.6599999999999999, 70.025999999999996], [1.6799999999999999, 69.509], [1.7, 69.280000000000001], [1.72, 68.787999999999997], [1.74, 68.033000000000001], [1.76, 67.738], [1.78, 67.704999999999998], [1.8, 67.640000000000001], [1.8200000000000001, 67.409999999999997], [1.8400000000000001, 67.409999999999997], [1.8600000000000001, 67.114999999999995], [1.8799999999999999, 66.951000000000008], [1.8999999999999999, 66.918000000000006], [1.9199999999999999, 66.656000000000006], [1.9399999999999999, 66.623000000000005], [1.96, 66.951000000000008], [1.98, 66.852000000000004], [2.0, 66.228999999999999], [2.02, 66.262], [2.04, 66.426000000000002], [2.0600000000000001, 66.492000000000004], [2.0800000000000001, 65.900999999999996], [2.1000000000000001, 66.131], [2.1200000000000001, 65.867999999999995], [2.1400000000000001, 65.442000000000007], [2.1600000000000001, 65.245000000000005], [2.1800000000000002, 65.180000000000007], [2.2000000000000002, 65.671999999999997], [2.2200000000000002, 65.344000000000008], [2.2400000000000002, 65.016000000000005], [2.2599999999999998, 65.344000000000008], [2.2799999999999998, 65.344000000000008], [2.2999999999999998, 64.884], [2.3199999999999998, 65.081000000000003], [2.3399999999999999, 64.622], [2.3599999999999999, 64.917000000000002], [2.3799999999999999, 64.588999999999999], [2.3999999999999999, 64.491], [2.4199999999999999, 64.819000000000003], [2.4399999999999999, 64.424999999999997], [2.46, 64.753], [2.48, 64.326999999999998], [2.5, 63.999000000000002], [2.52, 63.768999999999998], [2.54, 63.802], [2.5600000000000001, 64.031999999999996], [2.5800000000000001, 63.704000000000001], [2.6000000000000001, 63.572000000000003], [2.6200000000000001, 63.637999999999998], [2.6400000000000001, 63.441000000000003], [2.6600000000000001, 63.572000000000003], [2.6800000000000002, 63.539999999999999], [2.7000000000000002, 62.948999999999998], [2.7200000000000002, 63.310000000000002], [2.7400000000000002, 63.310000000000002], [2.7599999999999998, 63.376000000000005], [2.7799999999999998, 62.817999999999998], [2.7999999999999998, 62.523000000000003], [2.8199999999999998, 62.916000000000004], [2.8399999999999999, 62.392000000000003], [2.8599999999999999, 62.259999999999998], [2.8799999999999999, 62.359000000000002], [2.9119999999999999, 62.030999999999999]],
	[[0.0, 0.0], [0.02, 0.0], [0.040000000000000001, 0.0], [0.059999999999999998, 0.0], [0.080000000000000002, 0.0], [0.10000000000000001, 0.0], [0.12, 0.23400000000000001], [0.14000000000000001, 0.11700000000000001], [0.16, 0.23400000000000001], [0.17999999999999999, 0.23400000000000001], [0.20000000000000001, 0.35199999999999998], [0.22, 0.11700000000000001], [0.23999999999999999, 0.35199999999999998], [0.26000000000000001, 0.23400000000000001], [0.28000000000000003, 0.23400000000000001], [0.29999999999999999, 0.23400000000000001], [0.32000000000000001, 0.11700000000000001], [0.34000000000000002, 0.11700000000000001], [0.35999999999999999, 0.11700000000000001], [0.38, 0.23400000000000001], [0.40000000000000002, 0.23400000000000001], [0.41999999999999998, 0.23400000000000001], [0.44, 0.11700000000000001], [0.46000000000000002, 0.23400000000000001], [0.47999999999999998, 0.23400000000000001], [0.5, 0.11700000000000001], [0.52000000000000002, 0.93800000000000006], [0.54000000000000004, 1.173], [0.56000000000000005, 1.877], [0.57999999999999996, 2.581], [0.59999999999999998, 2.464], [0.62, 2.581], [0.64000000000000001, 2.9330000000000003], [0.66000000000000003, 3.8719999999999999], [0.68000000000000005, 4.4590000000000005], [0.69999999999999996, 5.6319999999999997], [0.71999999999999997, 6.2190000000000003], [0.73999999999999999, 6.806], [0.76000000000000001, 7.9790000000000001], [0.78000000000000003, 8.6829999999999998], [0.80000000000000004, 9.8569999999999993], [0.81999999999999995, 10.326000000000001], [0.83999999999999997, 10.913], [0.85999999999999999, 12.204000000000001], [0.88, 14.433], [0.90000000000000002, 17.719000000000001], [0.92000000000000004, 21.943000000000001], [0.93999999999999995, 25.933], [0.95999999999999996, 30.862000000000002], [0.97999999999999998, 36.728999999999999], [1.0, 43.066000000000003], [1.02, 47.994], [1.04, 52.688000000000002], [1.0600000000000001, 54.566000000000003], [1.0800000000000001, 61.724000000000004], [1.1000000000000001, 68.882000000000005], [1.1200000000000001, 76.040000000000006], [1.1399999999999999, 83.198000000000008], [1.1599999999999999, 90.356999999999999], [1.1799999999999999, 97.515000000000001], [1.2, 104.673], [1.22, 111.831], [1.24, 118.989], [1.26, 126.14700000000001], [1.28, 130.255], [1.3, 140.11199999999999], [1.3200000000000001, 152.55100000000002], [1.3400000000000001, 167.33600000000001], [1.3600000000000001, 181.887], [1.3799999999999999, 194.56100000000001], [1.3999999999999999, 205.005], [1.4199999999999999, 215.91800000000001], [1.4399999999999999, 228.59100000000001], [1.46, 260.15800000000002], [1.48, 318.596], [1.5, 355.209], [1.52, 427.49400000000003], [1.54, 492.27000000000004], [1.5600000000000001, 553.28999999999996], [1.5800000000000001, 608.91300000000001], [1.6000000000000001, 653.26999999999998], [1.6200000000000001, 683.66300000000001], [1.6399999999999999, 704.08100000000002], [1.6599999999999999, 718.86699999999996], [1.6799999999999999, 730.36699999999996], [1.7, 734.94299999999998], [1.72, 742.923], [1.74, 749.14200000000005], [1.76, 754.07100000000003], [1.78, 757.82600000000002], [1.8, 760.75999999999999], [1.8200000000000001, 762.98900000000003], [1.8400000000000001, 764.98400000000004], [1.8600000000000001, 766.15800000000002], [1.8799999999999999, 766.86199999999997], [1.8999999999999999, 767.33100000000002], [1.9199999999999999, 767.096], [1.9399999999999999, 767.21400000000006], [1.96, 767.096], [1.98, 766.86199999999997], [2.0, 766.62700000000007], [2.02, 765.57100000000003], [2.04, 764.39700000000005], [2.0600000000000001, 763.45900000000006], [2.0800000000000001, 762.51999999999998], [2.1000000000000001, 760.52499999999998], [2.1200000000000001, 758.52999999999997], [2.1400000000000001, 757.12200000000007], [2.1600000000000001, 754.77499999999998], [2.1800000000000002, 752.19299999999998], [2.2000000000000002, 748.78999999999996], [2.2200000000000002, 745.38700000000006], [2.2400000000000002, 741.86699999999996], [2.2599999999999998, 738.22900000000004], [2.2799999999999998, 734.59100000000001], [2.2999999999999998, 730.95400000000006], [2.3199999999999998, 727.19799999999998], [2.3399999999999999, 723.32600000000002], [2.3599999999999999, 721.33100000000002], [2.3799999999999999, 717.45900000000006], [2.3999999999999999, 713.58600000000001], [2.4199999999999999, 709.71400000000006], [2.4399999999999999, 706.07600000000002], [2.46, 702.20400000000006], [2.48, 698.21400000000006], [2.5, 694.69299999999998], [2.52, 691.28999999999996], [2.54, 687.88700000000006], [2.5600000000000001, 684.36699999999996], [2.5800000000000001, 682.60699999999997], [2.6000000000000001, 679.08600000000001], [2.6200000000000001, 675.68299999999999], [2.6400000000000001, 672.39700000000005], [2.6600000000000001, 668.75999999999999], [2.6800000000000002, 665.82600000000002], [2.7000000000000002, 663.24400000000003], [2.7200000000000002, 660.31100000000004], [2.7400000000000002, 657.37700000000007], [2.7599999999999998, 654.56100000000004], [2.7799999999999998, 653.26999999999998], [2.7999999999999998, 650.68799999999999], [2.8199999999999998, 647.98900000000003], [2.8399999999999999, 644.93799999999999], [2.8599999999999999, 642.12199999999996], [2.8799999999999999, 639.53999999999996], [2.9119999999999999, 635.19799999999998]]
]
var counter = 0
var curves = 10

export default class timeValue extends PureComponent {
	static defaultProps = {
		measureTime: 3.0,
	}

	static propTypes = {
		measureTime: PropTypes.number,
	}

	constructor(props) {
		super(props);
		this.state = {
			dataArray: new Array(curves)
		};
	}

	componentDidMount() {
		this.echartsInstance = this.echartsReactRef.getEchartsInstance();
		this.ticker = setTimeout(() => this.tick(), 100);

		this.zr = this.echartsInstance.getZr();
		this.zr.on('click', this.onChartClick);
	}

	componentWillUnmount() {
		clearTimeout(this.ticker)
	}

	onChartClick = (...rest) => {
		console.log('App:onClickChart', rest);
	};

	tick() {
		if (counter === 0) {
			this.echartsInstance.setOption(this.getOption())
		}
		else {
			for (var i=0; i<curves; i++) {
				this.echartsInstance.appendData({
					seriesIndex: i,
					data: [data[i%2][counter]]
				})
			}
		}

		if (counter >= data[0].length) {
			counter = 0;
		}
		else {
			counter++;
		}

		this.componentDidMount();
	}

	series() {
		let series = []
		for (let i = 0; i < this.state.dataArray.length; i++) {
			if ((i % 2) === 0) {
				series.push({
					data: [],
					yAxisIndex: 0,
					type: 'line',
					name: 'T' + (Math.trunc(i / 2) + 1),
				})
			}
			else {
				series.push({
					data: [],
					yAxisIndex: 1,
					type: 'line',
					name: 'p' + (Math.trunc(i / 2) + 1),
				})
			}
		}
		return series
	}

	getOption = () => {
		return {
			xAxis: {
				type: 'value',
				name: 'Time [s]',
				min: 0,
				max: this.props.measureTime,
			},
			yAxis: [{
				type: 'value',
				name: 'Temperature [°C]',
				min: 0,
				max: 100,
			},
			{
				type: 'value',
				name: 'Pressure [bar]',
				min: 0,
				max: 1000,
			}],
			tooltip: {
				trigger: 'axis',
				axisPointer: {
					type: 'cross',
					animation: false,
					label: {
						backgroundColor: '#ccc',
						borderColor: '#aaa',
						borderWidth: 1,
						shadowBlur: 0,
						shadowOffsetX: 0,
						shadowOffsetY: 0,
						color: '#222'
					}
				},
			},
			dataZoom: [{
				type: 'inside',
				throttle: 50
			}],
			series: this.series()
		};
	};

	render() {
		return (
			<ReactEcharts
				option={this.getOption()}
				style={{ height: '1000px', width: '100%' }}
				ref={(e) => { this.echartsReactRef = e; }}
				className='echarts_example' />
		);
	}
}