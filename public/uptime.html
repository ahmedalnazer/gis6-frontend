<!DOCTYPE html>
<html>
	<head>
		<title>Hello world</title>
	</head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.1/socket.io.js"></script>
	<script>
		var socket;
		
		document.onreadystatechange = function()
		{
			if (document.readyState != 'complete') return;
			
			socket = io.connect(':8000');
			console.log('Document load complete');
			
			socket.on('connect', function()
			{
				console.log('Connected to socket.io');
				socket.emit('join', { 'room' : 'uptime' } );
				//socket.join('uptime');
				console.log('Requested to join uptime room');
			});
			
			socket.on('reconnect', function()
			{
				console.log('Reconnected to socket.io');
				//socket.join('uptime');
				//console.log('Requested to join uptime room');
			});
			
			socket.on('disconnecting', function()
			{
				//socket.leave('uptime');
				console.log('Left uptime room');
			});
			
			socket.on('disconnect', function()
			{
				console.log('Disconnected from socket.io');
			});
			
			socket.on('uptime.uptime', function(data)
			{
				var int32View = new Uint32Array(data);
				var remainder = int32View[0];
				console.log('uptime: ' + remainder);

				var divisions = [60, 60, 24, 0];
				var text = '';
				var i, value;
				for (i = 0; i == 0 || remainder > 0; i++)
				{
					if (i > 0)
					{
						if (value < 10) text = ':0' + text;
						else text = ':' + text;
					}
					if (divisions[i] == 0)
					{
						text = value + text;
						remainder = 0;
					}
					else
					{
						value = remainder % divisions[i];
						text = value + text;
						remainder = Math.floor(remainder / divisions[i]);
					}
				}

				document.getElementById('uptime').textContent = text;
			});
		};
	</script>
	<body>
		<p>Uptime is <span id="uptime"/></p>
	</body>
</html>
